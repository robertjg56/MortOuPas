<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Recherche Biographique</title>
    <meta name="description" content="Découvrez si une personnalité est vivante ou décédée avec dates de naissance et photos">
    <meta name="theme-color" content="#003d7a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Recherche Bio">
    
    <!-- Icons pour PWA -->
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxODAiIGhlaWdodD0iMTgwIiByeD0iNDAiIGZpbGw9IiMwMDNkN2EiLz4KPGC2lyY2xlIGN4PSI5MCIgY3k9IjcwIiByPSIyNSIgZmlsbD0id2hpdGUiLz4KPHA+dGggZD0iTTkwIDEwNUMxMDIuMTUgMTA1IDExNSAxMTIuODUgMTE1IDEyNUgxMTVDMTE1IDEzNyAxMTUgMTQ1IDY1IDEyNSIgZmlsbD0id2hpdGUiLz4KPHN2Zz4=">
    <link rel="icon" type="image/png" sizes="32x32" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iOCIgZmlsbD0iIzAwM2Q3YSIvPgo8Y2lyY2xlIGN4PSIxNiIgY3k9IjEyIiByPSI0IiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNMTYgMThDMjAgMTggMjQgMjAgMjQgMjJIMjRDMjQgMjQgMjQgMjYgOCAyMiIgZmlsbD0id2hpdGUiLz4KPHN2Zz4=">
    
    <!-- Manifest PWA -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIlJlY2hlcmNoZSBCaW9ncmFwaGlxdWUiLAogICJzaG9ydF9uYW1lIjogIlJlY2hlcmNoZSBCaW8iLAogICJkZXNjcmlwdGlvbiI6ICJEw6ljb3V2cmV6IHNpIHVuZSBwZXJzb25uYWxpdMOpIGVzdCB2aXZhbnRlIG91IGTDqWPDqWTDqWUiLAogICJzdGFydF91cmwiOiAiLiIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzAwM2Q3YSIsCiAgInRoZW1lX2NvbG9yIjogIiMwMDNkN2EiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUIzYVdSMGFEMGlNVGd3SWlCb1pXbG5hSFE5SWpFNE1DSWlJSFpwWlhkQ2IzZzlJakFnTUNBeE9EQWdNVGd3SWlCbWFXeHNQU0p1YjI1bElpQjRiV3h1Y3owcWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaVBnbzhjbVZqZENCM2FXUjBhRDBpTVRnd0lpQm9aV2xuYUhROUlqRTRNQ0lpSUhKNFBTSXpOQ0lpSUdacGJHdzlJaU13TURObE4yRWlMejRLUEdOcGNtTnNaU0JqZUQwaU9UQWLJR041UFNJMk1TSWlJSEk5U1RJMUlpQm1hV3hzUFNKM2FHbDBaU0l2UGdvOGNHRjBhU0JrUFNKTk9UQWdNVEExUXpFdU9qSXdOREJUTVNBd1JIVTVNVGR2SWlCbWFXeHNQU0ozYUdsMFpTSXZQZ284TDNOMlp6ND0iLAogICAgICAic2l6ZXMiOiAiMTgweDE4MCIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9CiAgXQp9">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            height: 100%;
            -webkit-text-size-adjust: 100%;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #003d7a 0%, #0056b3 50%, #007bff 100%);
            min-height: 100vh;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
            display: flex;
            flex-direction: column;
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            color: white;
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .header .subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }

        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .search-container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 61, 122, 0.2);
        }

        .input-group {
            position: relative;
            margin-bottom: 15px;
        }

        .input-container {
            position: relative;
        }

        input[type="text"] {
            width: 100%;
            padding: 16px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 16px;
            background: #ffffff;
            outline: none;
            transition: all 0.3s ease;
            -webkit-appearance: none;
        }

        input[type="text"]:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }

        .suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #007bff;
            border-top: none;
            border-radius: 0 0 12px 12px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 8px 25px rgba(0, 61, 122, 0.15);
        }

        .suggestion-item {
            padding: 15px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.2s ease;
            font-size: 16px;
            text-align: left;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-item:hover,
        .suggestion-item.selected {
            background: #007bff;
            color: white;
        }

        button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #003d7a, #007bff);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            -webkit-appearance: none;
        }

        button:active {
            transform: scale(0.98);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 30px;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 16px;
            margin-bottom: 20px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e9ecef;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result {
            display: none;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 16px;
            padding: 25px;
            animation: fadeIn 0.5s ease;
            box-shadow: 0 10px 30px rgba(0, 61, 122, 0.15);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-content {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .result-image-container {
            flex-shrink: 0;
            width: 100px;
            height: 100px;
            border-radius: 12px;
            overflow: hidden;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #e9ecef;
        }

        .result-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .no-image {
            color: #6c757d;
            font-size: 2rem;
        }

        .result-info {
            flex: 1;
            min-width: 0;
        }

        .result.alive .result-content {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: -10px -10px 15px -10px;
        }

        .result.dead .result-content {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: -10px -10px 15px -10px;
        }

        .result.error .result-content {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: -10px -10px 15px -10px;
        }

        .result-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .result-title {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .result-details {
            font-size: 1rem;
            opacity: 0.95;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .age-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.25);
            padding: 10px 18px;
            border-radius: 25px;
            margin: 8px 4px;
            font-weight: 600;
            font-size: 0.95rem;
            border: 2px solid rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(5px);
        }

        .wikipedia-link {
            display: inline-block;
            margin-top: 15px;
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.25);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            border: 2px solid rgba(255, 255, 255, 0.4);
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .wikipedia-link:active {
            transform: scale(0.95);
        }

        .install-prompt {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 15px;
            margin: 20px;
            border-radius: 12px;
            text-align: center;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: none;
        }

        .install-button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 10px 20px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 14px;
        }

        /* Responsive pour mobile */
        @media (max-width: 480px) {
            .main-content {
                padding: 15px;
            }

            .search-container {
                padding: 20px;
            }

            .result-content {
                flex-direction: column;
                text-align: center;
            }

            .result-image-container {
                width: 80px;
                height: 80px;
                margin: 0 auto 15px;
            }

            .age-badge {
                display: block;
                margin: 8px 0;
            }
        }

        /* Support mode sombre iOS */
        @media (prefers-color-scheme: dark) {
            .search-container, .result, .loading {
                background: rgba(28, 28, 30, 0.95);
                color: #ffffff;
            }
            
            input[type="text"] {
                background: #1c1c1e;
                color: #ffffff;
                border-color: #38383a;
            }
            
            .suggestion-item {
                background: #1c1c1e;
                color: #ffffff;
                border-color: #38383a;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🔍 Recherche Biographique</h1>
        <p class="subtitle">Découvrez le statut vital des personnalités</p>
    </div>

    <div class="install-prompt" id="installPrompt">
        <p>📱 Installez cette app sur votre iPhone !</p>
        <p style="font-size: 0.9rem; opacity: 0.8; margin: 8px 0;">Appuyez sur <strong>Partager</strong> puis <strong>Sur l'écran d'accueil</strong></p>
        <button class="install-button" onclick="hideInstallPrompt()">Compris</button>
    </div>

    <div class="main-content">
        <div class="search-container">
            <form id="searchForm">
                <div class="input-group">
                    <div class="input-container">
                        <input 
                            type="text" 
                            id="personName" 
                            placeholder="Nom de la personnalité..."
                            autocomplete="off"
                            required
                        >
                        <div class="suggestions" id="suggestions"></div>
                    </div>
                </div>
                <button type="submit" id="searchBtn">Rechercher</button>
            </form>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Recherche en cours...</p>
        </div>

        <div class="result" id="result">
            <div class="result-content">
                <div class="result-image-container" id="imageContainer">
                    <div class="no-image" id="noImage">👤</div>
                    <img class="result-image" id="resultImage" style="display: none;">
                </div>
                <div class="result-info">
                    <div class="result-icon" id="resultIcon"></div>
                    <div class="result-title" id="resultTitle"></div>
                    <div class="result-details" id="resultDetails"></div>
                    <div id="ageInfo"></div>
                    <a class="wikipedia-link" id="wikipediaLink" target="_blank" style="display: none;">
                        📖 Voir Wikipedia
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // PWA Installation
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPrompt').style.display = 'block';
        });

        function hideInstallPrompt() {
            document.getElementById('installPrompt').style.display = 'none';
        }

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('data:text/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZXZlbnQgPT4ge30pOwpzZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2FjdGl2YXRlJywgZXZlbnQgPT4ge30pOwpzZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2ZldGNoJywgZXZlbnQgPT4ge30pOw==')
                .catch(err => console.log('SW registration failed'));
            });
        }

        class LifeChecker {
            constructor() {
                this.form = document.getElementById('searchForm');
                this.nameInput = document.getElementById('personName');
                this.searchBtn = document.getElementById('searchBtn');
                this.loading = document.getElementById('loading');
                this.result = document.getElementById('result');
                this.resultIcon = document.getElementById('resultIcon');
                this.resultTitle = document.getElementById('resultTitle');
                this.resultDetails = document.getElementById('resultDetails');
                this.ageInfo = document.getElementById('ageInfo');
                this.wikipediaLink = document.getElementById('wikipediaLink');
                this.suggestions = document.getElementById('suggestions');
                this.resultImage = document.getElementById('resultImage');
                this.noImage = document.getElementById('noImage');
                
                this.suggestionsData = [];
                this.selectedIndex = -1;
                this.searchTimeout = null;
                
                this.init();
            }

            init() {
                this.form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.search();
                });

                this.nameInput.addEventListener('input', (e) => {
                    this.handleInput(e.target.value);
                });

                this.nameInput.addEventListener('keydown', (e) => {
                    this.handleKeydown(e);
                });

                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.input-container')) {
                        this.hideSuggestions();
                    }
                });

                // Prévenir le zoom sur iOS
                this.nameInput.addEventListener('touchstart', (e) => {
                    this.nameInput.style.fontSize = '16px';
                });
            }

            handleInput(value) {
                clearTimeout(this.searchTimeout);
                
                if (value.length < 2) {
                    this.hideSuggestions();
                    return;
                }

                this.searchTimeout = setTimeout(() => {
                    this.getSuggestions(value);
                }, 300);
            }

            async getSuggestions(query) {
                try {
                    const url = `https://fr.wikipedia.org/w/api.php?action=opensearch&search=${encodeURIComponent(query)}&limit=5&namespace=0&format=json&origin=*`;
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    this.suggestionsData = data[1] || [];
                    this.displaySuggestions();
                } catch (error) {
                    this.hideSuggestions();
                }
            }

            displaySuggestions() {
                if (this.suggestionsData.length === 0) {
                    this.hideSuggestions();
                    return;
                }

                this.suggestions.innerHTML = '';
                this.selectedIndex = -1;

                this.suggestionsData.forEach((suggestion, index) => {
                    const item = document.createElement('div');
                    item.className = 'suggestion-item';
                    item.textContent = suggestion;
                    item.addEventListener('click', () => {
                        this.selectSuggestion(suggestion);
                    });
                    this.suggestions.appendChild(item);
                });

                this.suggestions.style.display = 'block';
            }

            handleKeydown(e) {
                if (this.suggestions.style.display === 'none') return;

                switch (e.key) {
                    case 'ArrowDown':
                        e.preventDefault();
                        this.selectedIndex = Math.min(this.selectedIndex + 1, this.suggestionsData.length - 1);
                        this.updateSelection();
                        break;
                    case 'ArrowUp':
                        e.preventDefault();
                        this.selectedIndex = Math.max(this.selectedIndex - 1, -1);
                        this.updateSelection();
                        break;
                    case 'Enter':
                        e.preventDefault();
                        if (this.selectedIndex >= 0) {
                            this.selectSuggestion(this.suggestionsData[this.selectedIndex]);
                        } else {
                            this.search();
                        }
                        break;
                    case 'Escape':
                        this.hideSuggestions();
                        break;
                }
            }

            updateSelection() {
                const items = this.suggestions.querySelectorAll('.suggestion-item');
                items.forEach((item, index) => {
                    item.classList.toggle('selected', index === this.selectedIndex);
                });
            }

            selectSuggestion(suggestion) {
                this.nameInput.value = suggestion;
                this.hideSuggestions();
                this.search();
            }

            hideSuggestions() {
                this.suggestions.style.display = 'none';
                this.selectedIndex = -1;
            }

            async search() {
                const name = this.nameInput.value.trim();
                if (!name) return;

                this.showLoading();
                
                try {
                    const data = await this.searchWikipedia(name);
                    this.displayResult(data);
                } catch (error) {
                    this.displayError(error.message);
                } finally {
                    this.hideLoading();
                }
            }

            async searchWikipedia(name) {
                const searchUrl = `https://fr.wikipedia.org/w/api.php?action=opensearch&search=${encodeURIComponent(name)}&limit=1&namespace=0&format=json&origin=*`;
                const searchResponse = await fetch(searchUrl);
                const searchData = await searchResponse.json();
                
                if (!searchData[1] || searchData[1].length === 0) {
                    throw new Error('Aucun article trouvé');
                }

                const title = searchData[1][0];
                const url = searchData[3][0];
                
                // Récupérer BEAUCOUP plus de contenu (sections importantes)
                const extractUrl = `https://fr.wikipedia.org/w/api.php?action=query&format=json&prop=extracts|pageprops&exsectionformat=wiki&explaintext=1&exlimit=1&titles=${encodeURIComponent(title)}&origin=*`;
                const extractResponse = await fetch(extractUrl);
                const extractData = await extractResponse.json();
                
                const pageId = Object.keys(extractData.query.pages)[0];
                const page = extractData.query.pages[pageId];
                const extract = page.extract || '';
                
                // Récupérer aussi l'infobox et les catégories
                const infoUrl = `https://fr.wikipedia.org/w/api.php?action=query&format=json&prop=revisions|categories&rvprop=content&rvsection=0&cllimit=50&titles=${encodeURIComponent(title)}&origin=*`;
                const infoResponse = await fetch(infoUrl);
                const infoData = await infoResponse.json();
                
                let infoboxContent = '';
                let categories = [];
                
                if (infoData.query.pages[pageId]) {
                    // Contenu de l'infobox
                    if (infoData.query.pages[pageId].revisions) {
                        infoboxContent = infoData.query.pages[pageId].revisions[0].content || '';
                    }
                    
                    // Catégories
                    if (infoData.query.pages[pageId].categories) {
                        categories = infoData.query.pages[pageId].categories.map(cat => cat.title);
                    }
                }

                const imageUrl = await this.getImage(title);

                return { 
                    title, 
                    extract, 
                    infoboxContent,
                    categories: categories.join(' '),
                    url, 
                    imageUrl 
                };
            }

            async getImage(title) {
                try {
                    const imageUrl = `https://fr.wikipedia.org/w/api.php?action=query&format=json&prop=pageimages&pithumbsize=300&titles=${encodeURIComponent(title)}&origin=*`;
                    const response = await fetch(imageUrl);
                    const data = await response.json();
                    
                    const pageId = Object.keys(data.query.pages)[0];
                    const page = data.query.pages[pageId];
                    
                    return page.thumbnail ? page.thumbnail.source : null;
                } catch (error) {
                    return null;
                }
            }

            analyzeStatus(data) {
                const fullText = (data.extract + ' ' + data.infoboxContent + ' ' + data.categories).toLowerCase();
                
                console.log('🔍 Analyse de:', data.title);
                console.log('📝 Texte analysé (début):', fullText.substring(0, 300));
                
                // === PRIORITÉ ABSOLUE : PATTERNS DE DATES ===
                
                // 1. Format (YYYY-YYYY) = MORT CERTAIN
                const deathRange = fullText.match(/\(\s*\d{4}\s*[-–]\s*\d{4}\s*\)/);
                if (deathRange) {
                    console.log('💀 MORT CERTAIN - Pattern date:', deathRange[0]);
                    return 'dead';
                }
                
                // 2. Format (YYYY-) = VIVANT CERTAIN  
                const lifeRange = fullText.match(/\(\s*\d{4}\s*[-–]\s*\)/);
                if (lifeRange) {
                    console.log('✅ VIVANT CERTAIN - Pattern date:', lifeRange[0]);
                    return 'alive';
                }
                
                // === ANALYSE PAR MOTS-CLÉS SIMPLES ===
                
                let deathScore = 0;
                let lifeScore = 0;
                
                // Mots de DÉCÈS (plus restrictifs)
                const deathWords = [
                    'est mort', 'est morte', 'died in', 'died on', 'death in',
                    'décédé en', 'décédée en', 'mort en', 'morte en',
                    'fut tué', 'fut tuée', 'was killed', 'was murdered',
                    'suicide', 'assassiné', 'assassinée'
                ];
                
                deathWords.forEach(word => {
                    if (fullText.includes(word)) {
                        deathScore += 3;
                        console.log('💀 Mot décès trouvé:', word);
                    }
                });
                
                // Mots de VIE (plus restrictifs)
                const lifeWords = [
                    'est un', 'est une', 'is a', 'is an',
                    'actuellement', 'currently', 'today',
                    'continue', 'continues', 'works'
                ];
                
                lifeWords.forEach(word => {
                    if (fullText.includes(word)) {
                        lifeScore += 2;
                        console.log('✅ Mot vie trouvé:', word);
                    }
                });
                
                // === ANALYSE DES VERBES (INDICATEUR FAIBLE) ===
                
                // Compter "fut/était/was" (passé) vs "est/is" (présent)
                const pastVerbs = (fullText.match(/\b(fut|était|was)\s+(un|une|a|an|the)\b/g) || []).length;
                const presentVerbs = (fullText.match(/\b(est|is)\s+(un|une|a|an|the)\b/g) || []).length;
                
                console.log('📊 Verbes - Passé:', pastVerbs, 'Présent:', presentVerbs);
                
                if (pastVerbs > presentVerbs + 2) {
                    deathScore += 1;
                    console.log('💀 Majorité de verbes au passé');
                } else if (presentVerbs > pastVerbs) {
                    lifeScore += 1;
                    console.log('✅ Majorité de verbes au présent');
                }
                
                // === DÉCISION FINALE ===
                
                console.log('📊 Scores finaux - Décès:', deathScore, 'Vie:', lifeScore);
                
                if (deathScore > lifeScore) {
                    console.log('💀 RÉSULTAT: DÉCÉDÉ');
                    return 'dead';
                } else if (lifeScore > deathScore) {
                    console.log('✅ RÉSULTAT: VIVANT');
                    return 'alive';
                } else {
                    // En cas d'égalité, analyser le début du texte plus finement
                    const firstSentence = fullText.substring(0, 150);
                    console.log('⚖️ Égalité - Analyse première phrase:', firstSentence);
                    
                    if (firstSentence.includes('fut ') || firstSentence.includes('était ') || firstSentence.includes('was ')) {
                        console.log('💀 RÉSULTAT: DÉCÉDÉ (verbe passé en début)');
                        return 'dead';
                    } else {
                        console.log('✅ RÉSULTAT: VIVANT (par défaut)');
                        return 'alive';
                    }
                }
            }

            extractBirthInfo(text) {
                const lowerText = text.toLowerCase();
                const originalText = text;
                
                const fullDatePatterns = [
                    {
                        pattern: /né(?:e)?\s+le\s+(\d{1,2})\s+(janvier|février|mars|avril|mai|juin|juillet|août|septembre|octobre|novembre|décembre)\s+(\d{4})/i,
                        format: 'day-month-year'
                    },
                    {
                        pattern: /born\s+(january|february|march|april|may|june|july|august|september|october|november|december)\s+(\d{1,2}),?\s+(\d{4})/i,
                        format: 'month-day-year'
                    }
                ];
                
                const months = {
                    'janvier': 1, 'février': 2, 'mars': 3, 'avril': 4, 'mai': 5, 'juin': 6,
                    'juillet': 7, 'août': 8, 'septembre': 9, 'octobre': 10, 'novembre': 11, 'décembre': 12,
                    'january': 1, 'february': 2, 'march': 3, 'april': 4, 'may': 5, 'june': 6,
                    'july': 7, 'august': 8, 'september': 9, 'october': 10, 'november': 11, 'december': 12
                };
                
                for (const {pattern, format} of fullDatePatterns) {
                    const match = originalText.match(pattern);
                    if (match) {
                        let day, month, year;
                        
                        if (format === 'day-month-year') {
                            day = parseInt(match[1]);
                            month = months[match[2].toLowerCase()];
                            year = parseInt(match[3]);
                        } else if (format === 'month-day-year') {
                            month = months[match[1].toLowerCase()];
                            day = parseInt(match[2]);
                            year = parseInt(match[3]);
                        }
                        
                        if (year >= 1900 && year <= new Date().getFullYear() && month >= 1 && month <= 12 && day >= 1 && day <= 31) {
                            const birthDate = new Date(year, month - 1, day);
                            const age = this.calculateAge(birthDate);
                            
                            return {
                                fullDate: `${day}/${month}/${year}`,
                                age: age,
                                hasFullDate: true
                            };
                        }
                    }
                }
                
                const yearPatterns = [
                    /\((\d{4})\s*[-–]\s*\)/,
                    /né(?:e)?\s+en\s+(\d{4})/,
                    /born\s+.*?(\d{4})/
                ];
                
                for (const pattern of yearPatterns) {
                    const match = lowerText.match(pattern);
                    if (match) {
                        const year = parseInt(match[1]);
                        if (year >= 1900 && year <= new Date().getFullYear()) {
                            const age = new Date().getFullYear() - year;
                            return {
                                fullDate: year.toString(),
                                age: age,
                                hasFullDate: false
                            };
                        }
                    }
                }
                
                return null;
            }

            calculateAge(birthDate) {
                const today = new Date();
                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                
                return age;
            }

            extractDeathInfo(text) {
                const lowerText = text.toLowerCase();
                const originalText = text;
                
                const deathDatePatterns = [
                    {
                        pattern: /mort\s+le\s+(\d{1,2})\s+(janvier|février|mars|avril|mai|juin|juillet|août|septembre|octobre|novembre|décembre)\s+(\d{4})/i,
                        format: 'day-month-year'
                    },
                    {
                        pattern: /died\s+(january|february|march|april|may|june|july|august|september|october|november|december)\s+(\d{1,2}),?\s+(\d{4})/i,
                        format: 'month-day-year'
                    }
                ];
                
                const months = {
                    'janvier': 1, 'février': 2, 'mars': 3, 'avril': 4, 'mai': 5, 'juin': 6,
                    'juillet': 7, 'août': 8, 'septembre': 9, 'octobre': 10, 'novembre': 11, 'décembre': 12,
                    'january': 1, 'february': 2, 'march': 3, 'april': 4, 'may': 5, 'june': 6,
                    'july': 7, 'august': 8, 'september': 9, 'october': 10, 'november': 11, 'december': 12
                };
                
                for (const {pattern, format} of deathDatePatterns) {
                    const match = originalText.match(pattern);
                    if (match) {
                        let day, month, year;
                        
                        if (format === 'day-month-year') {
                            day = parseInt(match[1]);
                            month = months[match[2].toLowerCase()];
                            year = parseInt(match[3]);
                        } else if (format === 'month-day-year') {
                            month = months[match[1].toLowerCase()];
                            day = parseInt(match[2]);
                            year = parseInt(match[3]);
                        }
                        
                        if (year >= 1900 && year <= new Date().getFullYear() && month >= 1 && month <= 12 && day >= 1 && day <= 31) {
                            return {
                                fullDate: `${day}/${month}/${year}`,
                                hasFullDate: true
                            };
                        }
                    }
                }
                
                const parenthesesMatch = lowerText.match(/\((\d{4})\s*[-–]\s*(\d{4})\)/);
                if (parenthesesMatch) {
                    const deathYear = parseInt(parenthesesMatch[2]);
                    if (deathYear >= 1900 && deathYear <= new Date().getFullYear()) {
                        return {
                            fullDate: deathYear.toString(),
                            hasFullDate: false
                        };
                    }
                }
                
                return null;
            }

            displayResult(data) {
                const status = this.analyzeStatus(data);
                
                this.result.className = `result ${status}`;
                this.result.style.display = 'block';
                
                if (data.imageUrl) {
                    this.resultImage.src = data.imageUrl;
                    this.resultImage.style.display = 'block';
                    this.noImage.style.display = 'none';
                    this.resultImage.onerror = () => {
                        this.resultImage.style.display = 'none';
                        this.noImage.style.display = 'flex';
                    };
                } else {
                    this.resultImage.style.display = 'none';
                    this.noImage.style.display = 'flex';
                }
                
                switch (status) {
                    case 'alive':
                        this.resultIcon.textContent = '✅';
                        this.resultTitle.textContent = 'Vivant(e)';
                        this.resultDetails.textContent = `${data.title} semble être encore en vie.`;
                        
                        const birthInfo = this.extractBirthInfo(data.extract + ' ' + data.infoboxContent);
                        if (birthInfo && birthInfo.age > 0 && birthInfo.age < 150) {
                            let birthDisplay = '';
                            if (birthInfo.hasFullDate) {
                                birthDisplay = `<div class="age-badge">🎂 ${birthInfo.fullDate} (${birthInfo.age} ans)</div>`;
                            } else {
                                birthDisplay = `<div class="age-badge">🎂 Né(e) en ${birthInfo.fullDate} (${birthInfo.age} ans)</div>`;
                            }
                            this.ageInfo.innerHTML = birthDisplay;
                        } else {
                            this.ageInfo.innerHTML = '';
                        }
                        break;
                        
                    case 'dead':
                        this.resultIcon.textContent = '💀';
                        this.resultTitle.textContent = 'Décédé(e)';
                        this.resultDetails.textContent = `${data.title} semble être décédé(e).`;
                        
                        const fullText = data.extract + ' ' + data.infoboxContent;
                        const birthInfoDead = this.extractBirthInfo(fullText);
                        const deathInfo = this.extractDeathInfo(fullText);
                        
                        let dateDisplay = '';
                        
                        if (birthInfoDead) {
                            if (birthInfoDead.hasFullDate) {
                                dateDisplay += `<div class="age-badge">🎂 ${birthInfoDead.fullDate}</div>`;
                            } else {
                                dateDisplay += `<div class="age-badge">🎂 Né(e) en ${birthInfoDead.fullDate}</div>`;
                            }
                        }
                        
                        if (deathInfo) {
                            if (deathInfo.hasFullDate) {
                                dateDisplay += `<div class="age-badge">⚰️ ${deathInfo.fullDate}</div>`;
                            } else {
                                dateDisplay += `<div class="age-badge">⚰️ Décédé(e) en ${deathInfo.fullDate}</div>`;
                            }
                        }
                        
                        this.ageInfo.innerHTML = dateDisplay;
                        break;
                }
                
                this.wikipediaLink.href = data.url;
                this.wikipediaLink.style.display = 'inline-block';
                
                // Scroll vers le résultat
                this.result.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }

            displayError(message) {
                this.result.className = 'result error';
                this.result.style.display = 'block';
                this.resultIcon.textContent = '❌';
                this.resultTitle.textContent = 'Erreur';
                this.resultDetails.textContent = message;
                this.ageInfo.innerHTML = '';
                this.wikipediaLink.style.display = 'none';
                this.resultImage.style.display = 'none';
                this.noImage.style.display = 'flex';
            }

            showLoading() {
                this.loading.style.display = 'block';
                this.result.style.display = 'none';
                this.searchBtn.disabled = true;
            }

            hideLoading() {
                this.loading.style.display = 'none';
                this.searchBtn.disabled = false;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new LifeChecker();
        });
    </script>
</body>
</html>
